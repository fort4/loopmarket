<!-- 
  checkout.html: 상품 구매 > 안전결제 확인 화면 (전체 페이지 렌더링용)

  하단에 외부 JS 스크립트 3개가 포함되어 있습니다.
    - postcode.v2.js: 다음 주소 검색 API
    - checkout-ui.js: 결제 화면 전용 입력 로직 (주소 입력, 수단 선택 등)
    - checkout.js: 결제 요청 처리 (/api/pay/safe API 연동)
-->

<th:block th:fragment="content">

  <!-- 로그인/상품 정보 JS 전달 -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    window.loginUser = {
      id: /*[[${loginUser.userId}]]*/ 0,
      name: /*[[${loginUser.nickname}]]*/ "",
      email: /*[[${loginUser.email}]]*/ "",
      balance: /*[[${balance}]]*/ 0
    };
    window.checkoutProduct = {
      id: /*[[${product.id}]]*/ 0,
      title: /*[[${product.title}]]*/ "",
      price: /*[[${product.price}]]*/ 0,
      imageUrl: /*[[${product.imageUrl}]]*/ "",
      tradeType: /*[[${product.tradeType}]]*/ ""
    };
    /*]]>*/
  </script>

  <!-- 화면 UI 구성 -->
  <div class="container py-5 text-start">
    <h2 class="mb-4">안전결제</h2>

    <div class="card mb-4">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h5 th:text="${product.title}">상품 제목</h5>
          <p class="mb-0 text-muted" th:text="'₩' + ${product.price}">150,000원</p>
        </div>
        <img th:src="${product.imageUrl}" alt="상품 이미지" width="80">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">거래 방식</label>
      <input type="text" class="form-control" th:value="${product.tradeType}" readonly>
    </div>

    <div class="mb-3" id="addressContainer" style="display: none;">
      <label class="form-label fw-bold">배송지</label>
      <div class="input-group">
        <input type="text" class="form-control" id="addressInput" placeholder="주소를 입력하세요" readonly>
        <button type="button" class="btn btn-outline-secondary" onclick="execDaumPostcode()">검색</button>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">결제 수단</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="payMethod" value="PAY" checked>
        <label class="form-check-label">
          자체페이 (잔액: <span th:text="${balance}">0</span>원)
        </label>
      </div>
    </div>

    <button type="button" class="btn btn-primary w-100" id="safePayBtn">결제하기</button>
  </div>

  <!-- 외부 스크립트 -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <!-- 다음 주소 API 스크립트 -->
  <script>
    function execDaumPostcode() {
      new daum.Postcode({
        oncomplete: function(data) {
          document.getElementById('addressInput').value = data.address;
        }
      }).open();
    }
  </script>

  <script src="/js/pay/checkout-ui.js"></script>
  <script src="/js/pay/checkout.js"></script>
</th:block>