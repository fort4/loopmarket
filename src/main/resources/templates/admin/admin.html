<div th:fragment="content" style="height: 100vh; display: flex; flex-direction: column; margin: 0;">
  <!-- 상단 헤더 -->
  <div class="admin-header d-flex justify-content-between align-items-center p-3 border-bottom" style="background-color: #f8f9fa;">
    <button class="btn btn-outline-secondary d-md-none" id="toggleSidebar">&#9776;</button>
  </div>

  <!-- 본문 전체 flex 레이아웃 -->
  <div class="admin-layout d-flex flex-grow-1" style="min-height: 0;">
    <!-- 사이드바 -->
    <div id="sidebarOverlay" class="overlay d-none"></div>
    <div class="sidebar p-3 border-end" id="adminSidebar">
      <h5 class="mb-4">관리자 메뉴</h5>
      <div class="btn-group-vertical w-100" role="group">
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/dashboard">대시보드</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/user">사용자 관리</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/products">상품 관리</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/reports">신고 관리</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/categories">카테고리 관리</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/notice">공지사항 관리</button>
        <button class="btn btn-outline-secondary text-start w-100 admin-link" data-url="/admin/notifications">알림 전송</button>
      </div>
    </div>

    <!-- 콘텐츠 영역 -->
    <main id="admin-content">
      <!-- AJAX 콘텐츠 로드 -->
    </main>
  </div>

  <!--<script src="https://code.jquery.com/jquery-3.7.1.js" 
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>-->

  <script th:inline="javascript">
    $(document).ready(function() {
		$('#toggleSidebar').on('click', function () {
		  $('#adminSidebar').toggleClass('show');
		  $('#sidebarOverlay').toggleClass('d-none');
		});

		// 오버레이 클릭 시 사이드바 닫기
		$('#sidebarOverlay').on('click', function () {
		  $('#adminSidebar').removeClass('show');
		  $(this).addClass('d-none');
		});
		
		function loadAdminPage(url) {
			
		  console.log("Loading admin page:", url);
		  $.ajax({
		    url: url,
		    method: 'GET',
			success: function(data) {
			  console.log("AJAX 성공", data);
			  $('#admin-content').html(data);

			  // ✅ URL에 따라 JS 로드
			  if (url === '/admin/dashboard') {
			    $('#admin-content').html(data); // 이걸 먼저 DOM에 붙이고

			    // 약간의 delay 후 JS 실행 → DOM 렌더 완료 후 실행 보장
			    setTimeout(function () {
			      $.getScript('/js/admin_dashboard.js')
			        .done(function () {
			          console.log('✅ admin_dashboard.js 로딩 완료');
			        })
			        .fail(function () {
			          console.error('❌ admin_dashboard.js 로드 실패');
			        });
			    }, 100); // 100~200ms 정도면 충분
			  } else if (url === '/admin/products') {
			    $.getScript('/js/admin_products.js')
			      .done(function () {
			        console.log('✅ admin_products.js 로딩 완료');
			      })
			      .fail(function () {
			        console.error('❌ admin_products.js 로드 실패');
			      });
			  } else if (url === '/admin/categories') {
			    $.getScript('/js/admin_category.js')
			      .done(function () {
			        console.log('✅ admin_category.js 로딩 완료');
			      })
			      .fail(function () {
			        console.error('❌ admin_category.js 로드 실패');
			      });
			  }
			},
		    error: function(xhr, status, error) {
		      console.error("AJAX 오류", status, error);
		      $('#admin-content').html('<p style="color:red;">페이지를 불러오지 못했습니다.</p>');
		    }
		  });
		}


      // 기본 페이지 로드
      loadAdminPage('/admin/dashboard');

      // 버튼 클릭 시 AJAX 요청
      $(document).on('click', '.admin-link', function (e) {
        e.preventDefault();
        const url = $(this).data('url');

        // active 클래스 처리
        $('.admin-link').removeClass('active');
        $(this).addClass('active');

        // AJAX 로드
        loadAdminPage(url);
      });
    });
  </script>

  <!-- 스타일 수정 -->
    <style>
      .admin-layout {
        display: flex;
        flex-grow: 1;
        height: 100%;
        overflow: hidden;
      }

      .sidebar {
        width: 200px;
        background-color: #f8f9fa;
        overflow-y: auto;
        flex-shrink: 0;
        height: 100%;
      }

      #admin-content {
        flex-grow: 1;
        padding: 2rem;
        background-color: #fff;
        overflow-y: auto;
      }

      /* 모바일 스타일 */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          top: 0;
          left: 0;
          width: 70%;
          height: 100vh;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          z-index: 999;
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background-color: rgba(0, 0, 0, 0.4);
          z-index: 998;
        }

        #toggleSidebar {
          display: block;
        }
      }

      @media (min-width: 769px) {
        .overlay {
          display: none !important;
        }

        #toggleSidebar {
          display: none;
        }

        .sidebar {
          position: relative;
          transform: none !important;
        }
      }
    </style>
  </div>