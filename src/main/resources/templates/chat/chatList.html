<div th:fragment="content" class="d-flex flex-column align-items-center w-100 px-3 px-md-0" style="max-width: 768px; margin: 0 auto;">
    <h4 class="mb-4">📨 나의 채팅방</h4>

    <!-- 채팅방 없을 경우 메시지 -->
    <div th:if="${chatSummaries != null and #lists.isEmpty(chatSummaries)}">
        <p class="text-muted">참여 중인 채팅방이 없습니다.</p>
    </div>

    <!-- 채팅방 목록 -->
    <div class="list-group w-100" th:if="${chatSummaries != null and !#lists.isEmpty(chatSummaries)}">
        <a th:each="summary : ${chatSummaries}"
           th:href="@{/chat/room/{id}(id=${summary.room.roomId})}"
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3 fs-6">

            <div class="d-flex flex-column">
                <!-- 닉네임 -->
                <div>
                    <i class="bi bi-person-circle me-2"></i>
                    <strong th:text="${summary.opponentNickname}">상대방</strong>
                </div>
                <!-- 마지막 메시지 -->
                <div class="text-muted small" th:text="${summary.lastMessage}">(메시지 없음)</div>
            </div>
			
<!--		   <div class="position-relative">
		       <span class="badge rounded-pill bg-danger"
		             th:if="${summary.unreadCount > 0}"
		             th:text="${summary.unreadCount > 9 ? '.' : summary.unreadCount}"
		             style="font-size: 0.8rem; position: absolute; top: -5px; right: -10px;">
		       </span>
		   </div>-->
			
   			<!-- 채팅방 목록 우측에 채팅온 개수(뱃지) -->
		   <div class="text-end" style="min-width: 60px;">
		       <!-- badge 추가 -->
		       <span class="badge rounded-pill bg-danger"
		             th:id="'chat-badge-' + ${summary.room.roomId}"
		             style="font-size: 0.8rem; display: none;">
		           <!-- JS에서 숫자 삽입 -->
		       </span><br/>
    			<!-- 마지막 메시지 시간 -->
		       <small class="text-muted" th:if="${summary.lastTime != null}"
		              th:text="${#temporals.format(summary.lastTime, 'MM/dd HH:mm')}">00:00</small>
		   </div>
        </a>
    </div> <!--채팅방 목록 끝-->
	
	<script>
	$(document).ready(function () {
	    function updateUnreadBadges() {
	        $.get("/chat/api/unread-summary", function (data) {
	            // 모든 뱃지를 초기화
	            $("[id^=chat-badge-]").hide();

	            data.forEach(item => {
	                const badge = $("#chat-badge-" + item.roomId);
	                if (badge.length > 0 && item.count > 0) {
	                    badge.text(item.count > 9 ? "." : item.count);
	                    badge.show();
	                }
	            });
	        }).fail(function () {
	            console.error("채팅 알림 불러오기 실패");
	        });
	    }

	    // 최초 실행
	    updateUnreadBadges();

	    // 주기적 갱신(10초 간격)
	    setInterval(updateUnreadBadges, 5000);
	});
	</script>

</div>
